<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gugugou.provider.commodity.dao.SkuDao">

    <resultMap id="Sku" type="com.gugugou.provider.commodity.model.SkuModel">
        <id column="id" property="id"/>
        <result column="tenant_id" property="tenantId"/>
        <result column="item_id" property="itemId"/>
        <result column="sku_template_id" property="skuTemplateId"/>
        <result column="sku_code" property="skuCode"/>
        <result column="barcode" property="barcode"/>
        <result column="outer_id" property="outerId"/>
        <result column="shop_id" property="shopId"/>
        <result column="name" property="name"/>
        <result column="image" property="image"/>
        <result column="status" property="status"/>
        <result column="audit_status" property="auditStatus"/>
        <result column="type" property="type"/>
        <result column="business_type" property="businessType"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="price" property="price"/>
        <result column="original_price" property="originalPrice"/>
        <result column="categoryIds" property="categoryIds"/>
        <result column="is_mini_program" property="isMiniProgram"/>
    </resultMap>

    <sql id="col">
        id,tenant_id,item_id,sku_template_id,sku_code,barcode,outer_id,shop_id,name,image,status,audit_status,type,business_type,updated_at,price,original_price,categoryIds,is_mini_program
    </sql>

    <select id="searchSku" parameterType="com.gugugou.provider.commodity.model.SkuModel" resultMap="Sku">
        SELECT
        <include refid="col"/>
        FROM index_sku
        WHERE tenant_id = ${tenantId}
        <if test="id != null">AND id = '${id}'</if>
        <if test="itemId != null">AND item_id = '${itemId}'</if>
        <if test="name != null and name != ''">AND name LIKE '${name}'</if>
        <if test="isMiniProgram != null"> and is_mini_program like '${isMiniProgram}'</if>
        <if test="skuCode != null and skuCode != ''">AND sku_code = '${skuCode}'</if>
        <if test="lowPrice != null">
            AND price between '${lowPrice}' and '${highPrice}'
            AND original_price between '${lowPrice}' and '${highPrice}'
        </if>
        <if test="shopIdList != null">
            AND shop_id IN
            <foreach collection="shopIdList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="categoryIdList != null">
            AND categoryIds IN
            <foreach collection="categoryIdList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="filterCategoryIdList != null">
            AND categoryIds IN
            <foreach collection="filterCategoryIdList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="excludeCategoryIdList != null">
            AND categoryIds NOT IN
            <foreach collection="excludeCategoryIdList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="typeList != null">
            AND type IN
            <foreach collection="typeList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="businessTypeList != null">
            AND business_type IN
            <foreach collection="businessTypeList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="excludeBusinessTypeList != null">
            AND business_type NOT IN
            <foreach collection="excludeBusinessTypeList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        <if test="statusList != null">
            AND status IN
            <foreach collection="statusList" item="item" separator="," open="(" close=")">
                '${item}'
            </foreach>
        </if>
        ORDER BY _score,updated_at DESC;
    </select>

</mapper>